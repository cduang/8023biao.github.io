    --[[
这个文件为圣手main主代码
我直接明码传输，你想拿就拿。
为什么不加密？加密太长了，这个也不是啥稀奇东西


by:biao
]]

    layout={
      LinearLayout;
      orientation="vertical";
      layout_width="fill";
      layout_height="fill";
      orientation="vertical";
      gravity="center";
      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";
        {
          Button;
          text="开启";
          id="button";
        };
        {
          Button;
          text="刷新游客";
          id="button_4";
        };

      };

      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";

        {
          Button;
          text="转32位";
          id="to32";
        };
        {
          Button;
          text="转64位";
          id="to64";
        };

      };
      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";
        {
          Button;
          text="联系我";
          id="button_3";
        };

        {
          Button;
          text="加群讨论";
          id="button_2";
        };
      };
      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";
        {
          Button;
          text="打开游戏";
          id="button_6";
        };

        {
          Button;
          text="下载地址";
          id="button_5";
        };

      };
      {
        LinearLayout;
        orientation="horizontal";
        layout_width="fill";
        layout_height="-2";
        gravity="center";
        padding="10dp";
        {
          TextView;
          id="text";
        };
      };

    };

    ---------layout



    ----------main code

    --activity.setTitle('title')
    --activity.setTheme(android.R.style.Theme_Holo_Light)
    activity.setContentView(loadlayout(layout))

    local nr="刚开始学习的第二天，大家多多见谅，轻喷，谢谢"..
    "\n唯二的两个功能可能已经失效，能力有限。\n\n"..
    "刷新访客,转32,转64是测试功能，有问题请反馈。\n"..
    "由于二进制由群主提供，我只负责软件问题，所以很难更新功能\n"..
    "希望大家可以提供些帮助，谢谢。\n"..

    "\nby:biao"


    text.setText(nr)


    全屏()--自定义封装代码
    设置主题()--自定义封装代码


    -----事件


    to32.onClick=function()
      local local mod=读取缓存("模式")
      if mod=="root" then

        local data=[[pm path com.sofunny.Sausage|sed -E  's/(.*):(.*)/\2/'|xargs pm install -r --abi armeabi-v7a]]

        xpcall(function()
          Runtime.getRuntime().exec("su -c " .. data)
          print("转32位成功")
        end,function(e)

          提示文字("发现错误",e.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end)

       elseif mod==nil then
        print("请先点击开启按钮选择模式")
       else
        print("没有root权限")
      end

    end


    to64.onClick=function()
      local local mod=读取缓存("模式")
      if mod=="root" then

        local data=[[pm path com.sofunny.Sausage|sed -E  's/(.*):(.*)/\2/'|xargs pm install -r --abi arm64-v8a]]

        xpcall(function()
          Runtime.getRuntime().exec("su -c " .. data)
          print("转64成功")
        end,function(e)

          提示文字("发现错误",e.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end)

       elseif mod==nil then
        print("请先点击开启按钮选择模式")
       else
        print("没有root权限")
      end
    end

    button.onClick=function()

      -- 检查是否已经授予权限，大于6.0的系统适用，小于6.0系统默认打开，无需理会
      if Build.VERSION.SDK_INT >= 23 and Settings.canDrawOverlays(this)~=true then
        --     print("请给予悬浮窗权限 ")
        local intent=Intent()
        intent = Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION);
        intent.setData(Uri.parse("package:" .. activity.getPackageName()));
        activity.startActivity(Intent(intent))
        --  os.exit()
        print("请给予悬浮窗权限")
       else
        modes()
      end


    end

    button_2.onClick=function()
      pcall(function()
        QQ群(757754019)
      end)
    end

    button_3.onClick=function()
      pcall(function()
        QQ(2176909931)
      end)
    end

    button_4.onClick=function()

      local mod=读取缓存("模式")

      if mod=="no_root" then
        local path="/data/user/0/com.sofunny.Sausage/shared_prefs/*"

        xpcall(function()
          Runtime.getRuntime().exec("rm -r" .. path)
          print("游客已刷新\n请重新登录")
        end,function(e)

          提示文字("发现错误",e.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end)

       elseif mod=="root" then


        local path="/data/data/com.sofunny.Sausage/shared_prefs/*"

        xpcall(function()
          Runtime.getRuntime().exec("su -c rm -r " .. path)
          print("游客已刷新\n请重新登录")
        end,function(e)

          提示文字("发现错误",e.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end)

       elseif mod==nil then
        print("请先点击开启按钮选择模式")
       else--错误

        local e="mod :\n"..mod

        提示文字("发现错误",e.."\n\n ","反馈",
        function()
          复制文本(e.."\n\n")
          提示("已复制错误信息",1)
          QQ(2176909931)
        end)

      end
    end



    button_5.onClick=function()
      浏览器打开("https://biao8023.lanzouu.com/iFNGu06mxueb")
    end


    button_6.onClick=function()
      local packageName="com.sofunny.Sausage"
      local manager = activity.getPackageManager()
      local open = manager.getLaunchIntentForPackage(packageName)
      this.startActivity(open)
    end

    ------main code end



    -----悬浮窗
    --最小化
    minlay={
      LinearLayout,
      layout_width="-2",
      layout_height="-2",
      {
        CircleImageView;
        src="res/icon/xfq.png";
        layout_width="35dp";
        layout_height="35dp";
        id="Win_minWindow",
      };
    }


    --功能界面
    centerView={
      LinearLayout;
      layout_width="-2";
      background="#0";
      orientation="vertical";
      layout_height="match_parent";
      background="#00";--这里是悬浮窗的黑色背景可以自己改一下
      {
        ScrollView;
        layout_width="match_parent";
        layout_height="match_parent";
        padding="10px";
        OverScrollMode=2;
        {
          LinearLayout;
          layout_width="match_parent";
          orientation="vertical";

          {
            GridLayout;
            layout_marginLeft="2dp";
            layout_marginRight="8dp";
            columnCount="2";
            layout_marginTop="5dp";

            {
              CheckBox;
              text="全枪射速";
              textSize="15sp";
              textColor="#ffffff";
              id="全枪射速";
              OnCheckedChangeListener=function(v)

                if 全枪射速.checked==true then

                  execute({"res/so/ss"},"全枪射速:ON\n小蘑菇授权")

                 else

                  全枪射速.setChecked(true)
                  print("现在不可关闭\n请结束掉游戏和本程序进程")
                  --这里想关闭你再写个取消修改内存的二进制执行就行了

                end
              end;
            };

            {
              CheckBox;
              text="全枪无后";
              textSize="15sp";
              textColor="#ffffff";
              id="全枪无后";
              OnCheckedChangeListener=function(v)

                if 全枪无后.checked==true then

                  execute({"res/so/qqwh"},"全枪无后:ON")

                 else

                  全枪无后.setChecked(true)
                  print("现在不可关闭\n请结束掉游戏和本程序进程")
                  --这里想关闭你再写个取消修改内存的二进制执行就行了

                end
              end;

            };


          };


        };
      };
    }




    --悬浮窗展开的布局
    winlay={
      LinearLayout,
      layout_width="-2",
      layout_height="-2",
      {
        CardView,
        id="win_mainview",
        layout_width="-2",
        layout_height="-2",
        layout_margin="5dp",
        CardElevation="0",
        {
          LinearLayout,
          layout_width="-1",
          layout_height="-1",
          orientation="vertical",
          {
            CardView,
            layout_width="-1",
            layout_height="30dp",
            background="#ffffff",
            radius=0,
            {
              LinearLayout,
              layout_width="-1",
              layout_height="-1",
              {
                LinearLayout,
                layout_weight="1",
                layout_height="-1",
                {
                  TextView,
                  id="win_move",
                  layout_width="-1",
                  layout_height="-1",
                  paddingLeft="5dp",
                  gravity="left|center",
                  textColor="#0",
                  singleLine=true,
                  Text="圣手 1.0.4",
                  textSize="14sp",

                },
              },

              {
                RippleLayout,
                layout_height="-1",
                layout_width="30dp",
                rippleColor="#50555555",
                {
                  ImageView,
                  layout_width="-1",
                  layout_height="-1",
                  scaleType="centerCrop",
                  padding="3dp",
                  src="res/icon/minimize.png",
                  ColorFilter="#55212121",
                  onClick="changeWindow",
                },
              },
              {
                RippleLayout,
                layout_height="-1",
                layout_width="30dp",
                rippleColor="#50555555",
                {
                  ImageView,
                  layout_width="-1",
                  layout_height="-1",
                  scaleType="centerCrop",
                  padding="3dp",
                  src="res/icon/close.png",
                  ColorFilter="#55212121",
                  onClick="closes",
                },
              },
            },
          },
          centerView, --这里是悬浮窗中间的布局
        },
      },
    }


    fkts={
      LinearLayout;
      layout_width="match_parent";
      layout_height="match_parent";
      {
        SurfaceView;
        layout_width="match_parent";
        layout_height="match_parent";
        id="Win";
      };
    };



    wmManager=activity.getSystemService(Context.WINDOW_SERVICE) --获取窗口管理器

    wmParams =WindowManager.LayoutParams() --对象

    if tonumber(Build.VERSION.SDK) >= 26 then
      wmParams.type =WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY--安卓8以上悬浮窗打开方式
     else
      wmParams.type =WindowManager.LayoutParams.TYPE_SYSTEM_ALERT--安卓8以下的悬浮窗打开方式
    end

    wmParams.format =PixelFormat.RGBA_8888 --设置背景
    wmParams.flags=WindowManager.LayoutParams().FLAG_NOT_FOCUSABLE--焦点设置
    wmParams.gravity = Gravity.LEFT| Gravity.TOP --重力设置
    wmParams.x = activity.getWidth()/8
    wmParams.y = activity.getHeight()/6
    wmParams.width =WindowManager.LayoutParams.WRAP_CONTENT
    wmParams.height =WindowManager.LayoutParams.WRAP_CONTENT



    wmParams.alpha = 0.5;


    mainWindow=loadlayout(winlay)
    minWindow=loadlayout(minlay)

    function showWindow() --显示
      pcall(function()
        wmManager.addView(mainWindow,wmParams)
      end)
    end

    function closes(v) --关闭
      wmManager.removeView(mainWindow)
      XFC=nil
    end

    isMax=true --状态

    function changeWindow()
      if isMax==false then
        isMax=true
        wmManager.removeView(minWindow)
        wmManager.addView(mainWindow,wmParams)
       else
        isMax=false
        wmManager.removeView(mainWindow)
        wmManager.addView(minWindow,wmParams)
      end
    end

    function Win_minWindow.onClick(v)
      changeWindow()
    end

    function Win_minWindow.OnTouchListener(v,event) --移动
      if event.getAction()==MotionEvent.ACTION_DOWN then
        firstX=event.getRawX()
        firstY=event.getRawY()
        wmX=wmParams.x
        wmY=wmParams.y
       elseif event.getAction()==MotionEvent.ACTION_MOVE then
        wmParams.x=wmX+(event.getRawX()-firstX)
        wmParams.y=wmY+(event.getRawY()-firstY)
        wmManager.updateViewLayout(minWindow,wmParams)
       elseif event.getAction()==MotionEvent.ACTION_UP then
        --changeWindow()
      end
      return false
    end

    --移动
    function win_move.OnTouchListener(v,event) --移动
      if event.getAction()==MotionEvent.ACTION_DOWN then
        firstX=event.getRawX()
        firstY=event.getRawY()
        wmX=wmParams.x
        wmY=wmParams.y
       elseif event.getAction()==MotionEvent.ACTION_MOVE then
        wmParams.x=wmX+(event.getRawX()-firstX)
        wmParams.y=wmY+(event.getRawY()-firstY)
        wmManager.updateViewLayout(mainWindow,wmParams)
       elseif event.getAction()==MotionEvent.ACTION_UP then
      end
      return true
    end


    ---悬浮窗 end
