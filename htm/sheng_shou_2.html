
    --[[
这个文件为圣手main主代码
我直接明码传输，你想拿就拿。
为什么不加密？加密太长了，这个也不是啥稀奇东西


by:biao
]]

    layout={
      LinearLayout;
      orientation="vertical";
      layout_width="fill";
      layout_height="fill";
      orientation="vertical";
      gravity="center";
      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";
        {
          Button;
          text="开启";
          id="button";
        };
        {
          Button;
          text="刷新游客";
          id="button_4";
        };

      };

      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";

        {
          Button;
          text="转32位";
          id="to32";
        };
        {
          Button;
          text="转64位";
          id="to64";
        };

      };


      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";
        {
          Button;
          text="联系我";
          id="button_3";
        };

        {
          Button;
          text="加群讨论";
          id="button_2";
        };
      };
      {
        LinearLayout;
        gravity="center";
        orientation="horizontal";
        layout_height="-2";
        layout_width="fill";
        {
          Button;
          text="打开游戏";
          id="button_6";
        };

        {
          Button;
          text="下载地址";
          id="button_5";
        };

      };


    };

    ---------layout



    ----------main code

    --activity.setTitle('title')
    --activity.setTheme(android.R.style.Theme_Holo_Light)
    activity.setContentView(loadlayout(layout))



    全屏()--自定义封装代码
    设置主题()--自定义封装代码


    -----事件


    to32.onClick=function()
      local mod=读取缓存("模式")
      if mod=="root" then
        app_list("转32位",32)
      end
    end


    to64.onClick=function()
      local mod=读取缓存("模式")
      if mod=="root" then
        app_list("转64位",64)
      end
    end

    button.onClick=function()

      -- 检查是否已经授予权限，大于6.0的系统适用，小于6.0系统默认打开，无需理会
      if Build.VERSION.SDK_INT >= 23 and Settings.canDrawOverlays(this)~=true then
        --     print("请给予悬浮窗权限 ")
        local intent=Intent()
        intent = Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION);
        intent.setData(Uri.parse("package:" .. activity.getPackageName()));
        activity.startActivity(Intent(intent))
        --  os.exit()
        print("请给予悬浮窗权限")
       else
        modes()
      end


    end

    button_2.onClick=function()
      pcall(function()
        QQ群(757754019)
      end)
    end

    button_3.onClick=function()
      pcall(function()
        QQ(2176909931)
      end)
    end

    button_4.onClick=function()

      local mod=读取缓存("模式")

      if mod=="no_root" then
        local path="/data/user/0/com.sofunny.Sausage/shared_prefs/*"

        xpcall(function()
          Runtime.getRuntime().exec("rm -r" .. path)
          print("游客已刷新\n请重新登录")
        end,function(e)

          提示文字("发现错误",e.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end)

       elseif mod=="root" then


        local path="/data/data/com.sofunny.Sausage/shared_prefs/*"

        xpcall(function()
          Runtime.getRuntime().exec("su -c rm -r " .. path)
          print("游客已刷新\n请重新登录")
        end,function(e)

          提示文字("发现错误",e.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end)

       elseif mod==nil then
        print("请先点击开启按钮选择模式")
       else--错误

        local e="mod :\n"..mod

        提示文字("发现错误",e.."\n\n ","反馈",
        function()
          复制文本(e.."\n\n")
          提示("已复制错误信息",1)
          QQ(2176909931)
        end)

      end
    end



    button_5.onClick=function()
      浏览器打开("https://biao8023.lanzouu.com/iFNGu06mxueb")
    end


    button_6.onClick=function()
      pcall(function()
        local packageName="com.sofunny.Sausage"
        local manager = activity.getPackageManager()
        local open = manager.getLaunchIntentForPackage(packageName)
        this.startActivity(open)
      end)
    end




    ------main code end



    -----悬浮窗
    --最小化
    minlay={
      LinearLayout,
      layout_width="-2",
      layout_height="-2",
      {
        CircleImageView;
        src="icon.png";
        layout_width="35dp";
        layout_height="35dp";
        id="Win_minWindow",
      };
    }


    --功能界面
    centerView={
      LinearLayout;
      layout_width="-2";
      background="#0";
      orientation="vertical";
      layout_height="match_parent";
      background="#00";--这里是悬浮窗的黑色背景可以自己改一下
      {
        ScrollView;
        layout_width="match_parent";
        layout_height="match_parent";
        padding="10px";
        OverScrollMode=2;
        {
          LinearLayout;
          layout_width="match_parent";
          orientation="vertical";

          {
            GridLayout;
            layout_marginLeft="2dp";
            layout_marginRight="8dp";
            columnCount="2";
            layout_marginTop="5dp";

            {
              CheckBox;
              text="全枪射速";
              textSize="15sp";
              textColor="#ffffff";
              id="全枪射速";
              OnCheckedChangeListener=function(v)

                if 全枪射速.checked==true then

                  execute({"res/so/ss"},"全枪射速:ON\n小蘑菇授权")

                 else

                  全枪射速.setChecked(true)
                  print("现在不可关闭\n请结束掉游戏和本程序进程")
                  --这里想关闭你再写个取消修改内存的二进制执行就行了

                end
              end;
            };



          };


        };
      };
    }




    --悬浮窗展开的布局
    winlay={
      LinearLayout,
      layout_width="-2",
      layout_height="-2",
      {
        CardView,
        id="win_mainview",
        layout_width="-2",
        layout_height="-2",
        layout_margin="5dp",
        CardElevation="0",
        {
          LinearLayout,
          layout_width="-1",
          layout_height="-1",
          orientation="vertical",
          {
            CardView,
            layout_width="-1",
            layout_height="30dp",
            background="#ffffff",
            radius=0,
            {
              LinearLayout,
              layout_width="-1",
              layout_height="-1",
              {
                LinearLayout,
                layout_weight="1",
                layout_height="-1",
                {
                  TextView,
                  id="win_move",
                  layout_width="-1",
                  layout_height="-1",
                  paddingLeft="5dp",
                  gravity="left|center",
                  textColor="#0",
                  singleLine=true,
                  Text="圣手",
                  textSize="14sp",

                },
              },

              {
                RippleLayout,
                layout_height="-1",
                layout_width="30dp",
                rippleColor="#50555555",
                {
                  ImageView,
                  layout_width="-1",
                  layout_height="-1",
                  scaleType="centerCrop",
                  padding="3dp",
                  src="res/icon/minimize.png",
                  ColorFilter="#55212121",
                  onClick="changeWindow",
                },
              },
              {
                RippleLayout,
                layout_height="-1",
                layout_width="30dp",
                rippleColor="#50555555",
                {
                  ImageView,
                  layout_width="-1",
                  layout_height="-1",
                  scaleType="centerCrop",
                  padding="3dp",
                  src="res/icon/close.png",
                  ColorFilter="#55212121",
                  onClick="closes",
                },
              },
            },
          },
          centerView, --这里是悬浮窗中间的布局
        },
      },
    }


    fkts={
      LinearLayout;
      layout_width="match_parent";
      layout_height="match_parent";
      {
        SurfaceView;
        layout_width="match_parent";
        layout_height="match_parent";
        id="Win";
      };
    };



    wmManager=activity.getSystemService(Context.WINDOW_SERVICE) --获取窗口管理器

    wmParams =WindowManager.LayoutParams() --对象

    if tonumber(Build.VERSION.SDK) >= 26 then
      wmParams.type =WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY--安卓8以上悬浮窗打开方式
     else
      wmParams.type =WindowManager.LayoutParams.TYPE_SYSTEM_ALERT--安卓8以下的悬浮窗打开方式
    end

    wmParams.format =PixelFormat.RGBA_8888 --设置背景
    wmParams.flags=WindowManager.LayoutParams().FLAG_NOT_FOCUSABLE--焦点设置
    wmParams.gravity = Gravity.LEFT| Gravity.TOP --重力设置
    wmParams.x = activity.getWidth()/8
    wmParams.y = activity.getHeight()/6
    wmParams.width =WindowManager.LayoutParams.WRAP_CONTENT
    wmParams.height =WindowManager.LayoutParams.WRAP_CONTENT



    wmParams.alpha = 0.5;


    mainWindow=loadlayout(winlay)
    minWindow=loadlayout(minlay)

    function showWindow() --显示
      pcall(function()
        wmManager.addView(mainWindow,wmParams)
      end)
    end

    function closes(v) --关闭
      wmManager.removeView(mainWindow)
      XFC=nil
    end

    isMax=true --状态

    function changeWindow()
      if isMax==false then
        isMax=true
        wmManager.removeView(minWindow)
        wmManager.addView(mainWindow,wmParams)
       else
        isMax=false
        wmManager.removeView(mainWindow)
        wmManager.addView(minWindow,wmParams)
      end
    end

    function Win_minWindow.onClick(v)
      changeWindow()
    end

    function Win_minWindow.OnTouchListener(v,event) --移动
      if event.getAction()==MotionEvent.ACTION_DOWN then
        firstX=event.getRawX()
        firstY=event.getRawY()
        wmX=wmParams.x
        wmY=wmParams.y
       elseif event.getAction()==MotionEvent.ACTION_MOVE then
        wmParams.x=wmX+(event.getRawX()-firstX)
        wmParams.y=wmY+(event.getRawY()-firstY)
        wmManager.updateViewLayout(minWindow,wmParams)
       elseif event.getAction()==MotionEvent.ACTION_UP then
        --changeWindow()
      end
      return false
    end

    --移动
    function win_move.OnTouchListener(v,event) --移动
      if event.getAction()==MotionEvent.ACTION_DOWN then
        firstX=event.getRawX()
        firstY=event.getRawY()
        wmX=wmParams.x
        wmY=wmParams.y
       elseif event.getAction()==MotionEvent.ACTION_MOVE then
        wmParams.x=wmX+(event.getRawX()-firstX)
        wmParams.y=wmY+(event.getRawY()-firstY)
        wmManager.updateViewLayout(mainWindow,wmParams)
       elseif event.getAction()==MotionEvent.ACTION_UP then
      end
      return true
    end


    ---悬浮窗 end

    function app_list(title,num)
      local MyAppListWindow={
        LinearLayout,
        layout_width="-1",
        layout_height="-1",
        id="Win_AppListWindow",
        orientation="vertical",
        {
          ListView,
          layout_width="-1",
          layout_height="-1",
          id="id_appList",
          DividerHeight=0,
          VerticalScrollBarEnabled=false;
        },
      }

      单对话框(MyAppListWindow,title)

      pm=activity.getPackageManager() --图局pm对象

      local AppListItem={
        LinearLayout,
        layout_width="-1",
        layout_height="90dp",
        {
          CardView;
          CardElevation="0";
          CardBackgroundColor="#86cdcdcd";
          Radius="8dp";
          layout_width="-1";
          layout_height="-1";
          layout_marginTop="5dp",
          layout_marginBottom="5dp",
          layout_marginLeft="20dp",
          layout_marginRight="20dp",
          {
            CardView,
            layout_width="-1",
            layout_height="-1",

            Radius=dp2px(8)-4;
            layout_margin="4px";
            {
              LinearLayout,
              layout_width="-1",
              layout_height="-1",
              orientation="center",
              layout_margin="2dp";
              {
                ImageView,
                id="icon",
                layout_width="80dp",
                layout_height="-1",
                layout_margin="2dp",
              },
              {
                LinearLayout,
                layout_weight="1",
                layout_height="-1",
                orientation="vertical",
                {
                  TextView,
                  id="name",
                  textSize="16sp",
                  layout_width="-1",
                  layout_weight="1",
                  gravity="center|left",
                  layout_marginBottom="2dp",

                },
                {
                  TextView,
                  id="banb",
                  --    layout_height="-2",
                  layout_weight="1",
                  gravity="center|left",
                  layout_marginBottom="2dp",

                },
                {
                  TextView,
                  id="packagename",
                  layout_width="-1",
                  --   layout_height="-2",
                  gravity="center|left",
                  layout_marginBottom="6dp",
                },
              },
            },
          },
        },
      }

      function fun(l,n,b)
        if num==32 then
          local mod=读取缓存("模式")

          if mod=="root" then

            local data=[[pm path ]]..b..[[|sed -E  's/(.*):(.*)/\2/'|xargs pm install -r --abi armeabi-v7a]]

            xpcall(function()
              Runtime.getRuntime().exec("su -c " .. data)
              print(n..":转32位成功")
            end,function(e)

              提示文字("发现错误",e.."\n\n ","反馈",
              function()
                复制文本(e.."\n\n")
                提示("已复制错误信息",1)
                QQ(2176909931)
              end)

            end)

           elseif mod==nil then
            print("请先点击开启按钮选择模式")
           else
            print("没有root权限")
          end

         elseif num==64 then

          local mod=读取缓存("模式")
          if mod=="root" then

            local data=[[pm path ]]..b..[[|sed -E  's/(.*):(.*)/\2/'|xargs pm install -r --abi arm64-v8a]]

            xpcall(function()
              Runtime.getRuntime().exec("su -c " .. data)
              print(n..":转64成功")
            end,function(e)

              提示文字("发现错误",e.."\n\n ","反馈",
              function()
                复制文本(e.."\n\n")
                提示("已复制错误信息",1)
                QQ(2176909931)
              end)

            end)

           elseif mod==nil then
            print("请先点击开启按钮选择模式")
           else
            print("没有root权限")
          end

         else

          提示文字("x32x64:",num.."\n\n ","反馈",
          function()
            复制文本(e.."\n\n")
            提示("已复制错误信息",1)
            QQ(2176909931)
          end)

        end

      end



      function ShowAppOC()
        if tostring(Win_WindowInside)=="nil" then
          OpenAppList()
         else
          CloseAppList()
        end
      end

      function OpenAppList()
        id_MainWindow.addView(loadlayout(OutWindow)) --添加一个标准窗口
        win_wininthere.addView(loadlayout(MyAppListWindow)) --添加内容
        ShowAppList()
        function win_Close.onClick()
          CloseAppList()
        end
      end

      function CloseAppList() --AppList关闭
        id_MainWindow.removeView(Win_WindowInside)
        Win_WindowInside=nil
        Win_AppListWindow=nil
        win_wininthere=nil
        id_appList=nil
        AppListAdp=nil
        return
      end

      function ShowAppList() --AppList显示
        AppListAdp=LuaAdapter(activity,AppListItem) --适配器
        id_appList.setAdapter(AppListAdp) --设置Adp适配器
        id_appList.OnItemClickListener=function(l,v,i,p) --列表点击打开软件
          local pn=v.Tag.packagename.Text --包名
          local na=v.Tag.name.Text --名字
          local apkph=activity.getPackageManager().getApplicationInfo(pn, 0).sourceDir
          local apkph=tostring(apkph)
          fun(apkph,na,pn)
        end

        --
        id_appList.onItemLongClick=function(p,v,i,s)
          --列表项目被长按
          local pn=v.Tag.packagename.Text --包名
          local apkph=activity.getPackageManager().getApplicationInfo(pn, 0).sourceDir
          local apkph=tostring(apkph)
          print("已复制包名")
          复制文本(pn)
          return true
        end

        id_appList.OnLongClickListener=function(l,v,i,p)
        end

        local res=GetAppList() --筛选可手动启动运行的app

        t1=thread(function(res,pm)
          for n=1,#res-1 do
            call("AddApp",res,n,pm)
            this.sleep(60)
          end
        end,res,pm)

      end

      function AddApp(res,n,pm) --添加App  (数组,循环数,PackageManager)
        pcall(function()
          AppListAdp.add{ --适配器是AppListAdp
            name=res[n].loadLabel(pm),
            icon=res[n].activityInfo.loadIcon(pm),
            packagename=res[n].activityInfo.packageName,
            banb=activity.getPackageManager().getPackageInfo(res[n].activityInfo.packageName, 0).versionName.."   "..GetFileSize(activity.getPackageManager().getApplicationInfo(res[n].activityInfo.packageName, 0).sourceDir)
          }
        end)
      end

      function GetActivities(packaname) --GetActivities(包名)
        local localIntent = Intent("android.intent.action.MAIN",nil)
        localIntent.addCategory("android.intent.category.LAUNCHER")
        local appList = pm.queryIntentActivities(localIntent,0)
        for i=1,#appList-1 do
          local resolveInfo = appList.get(i)
          local packageStr = resolveInfo.activityInfo.packageName
          if (packageStr==packaname) then
            return resolveInfo.activityInfo.name --返回activity
          end
        end
      end

      function GetAppList() --返回两个参数,  resapp列表
        local AppList=pm.getInstalledPackages(0)
        local intent = Intent(Intent.ACTION_MAIN,nil)
        intent.addCategory(Intent.CATEGORY_LAUNCHER)
        local res = pm.queryIntentActivities(intent, 0)
        return res
      end

      function isOk(ret) --检查pcall
        rett={ret}
        if tostring(rett[1])=="false" then
          print("出错!  .."..tostring(rett[2]))
          return
        end
        return
      end

      function GetFileSize(path)
        size=File(tostring(path)).length()
        Sizes=Formatter.formatFileSize(activity, size)
        return Sizes
      end

      ShowAppList()
    end



    ------------------------end
